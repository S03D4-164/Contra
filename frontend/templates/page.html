{% extends "base.html" %}

{% block title %}
<title>
{% if p.is_page %}Page{% else %}Resource{% endif %}
</title>
{% endblock %}

{% block script %}
<script>
$(document).ready(
        function(){
                $('a.colorbox').colorbox({'photo':true});
                $('#job_table').DataTable({"order":[0, 'desc']});
		prettyPrint();
        }
);
</script>
{% endblock %}

{% block container %}

<div class="row">

<div id="page" class="col-md-12">

<div class="panel panel-primary ">
<div class="panel-heading">
{% if p.is_page %}Page{% else %}Resource{% endif %}
</div>
<div class="panel-body">

<div class="col-md-6">
<table class="table table-condensed ">
<tr><th class="col-md-3">
{% if p.is_page %}Page{% else %}Resource{% endif %}
</th>
<td><a class="btn btn-primary" href="/page/{{p.id}}">{{p.id}}</a></td></tr>
<tr><th>Created at</th><td>{{p.created_at|date:"c"}}</td></tr>
<tr><th>URL</th><td>{{p.url}}</td></tr>
<tr><th >Status</th><td>{{p.http_status}}</td></tr>
<tr><th >Webapp</th>
<td>
{% for w in p.webapp.all %}
{{w}}<br>
{% endfor %}
</td></tr>
</table>
</div>

<div class="col-md-6">
{% if capture %}
<table class="table table-condensed">
<tbody>
<tr><th class="col-md-3">Capture</th><td>{{capture.path}}</td></tr>
<tr><th>Commit</th><td>{{capture.commit}}</td></tr>
</tbody>
</table>
<a class="colorbox" href="/{{capture.path}}">
<img src="data:image/png;base64,{{thumbnail}}" style="border:solid thin lightgrey;display: block;margin: 0 auto;">
</a>
{% endif %}
</div>

</div><!--.panel-body-->
</div><!--.panel-->

</div><!--.page-->

<div id="Job" class="col-md-12">

<div class="panel panel-primary">
<div class="panel-heading">
Job
</div>
<div class="panel-body">
<table id="job_table" class="table table-condensed">
<thead>
<tr>
<th class="col-md-1">Job</th>
<th class="col-md-1">Query</th>
<th class="col-md-2">timestamp</th>
<th class="col-md-2">status</th>
<th>DNS</th>
<th>whois(domain)</th>
<th>whois(ip)</th>
</tr>
</thead>
<tbody>
{% for j in job %}
<tr>
<td><a class="btn btn-primary" href="/job/{{j.id}}">{{j.id}}</a></td>
<td><a class="btn btn-default" href="/query/{{j.query.id}}">{{j.query.id}}</a></td>
<td>{{j.created_at|date:"c"}}</td>
<td>{{j.status}}</td>
<td>
<a href="/dns/{{j.page.host_info.host_dns.id}}">{{j.page.host_info.host_dns.query}}</a><br>
<a href="/dns/{{j.page.host_info.domain_dns.id}}">{{j.page.host_info.domain_dns.query}}</a><br>
</td>
<td>
<a href="/whois_domain/{{j.page.host_info.domain_whois.id}}">{{j.page.host_info.domain_whois.domain}}</a></td>
<td>
{% for i in j.page.host_info.ip_whois.all %}
<img src="/static/images/flags/{{i.country|lower}}.png" title="/static/images/flags/{{i.country|lower}}"><a href="/whois_ip/{{i.id}}">{{i.ip}}</a><br>
{% endfor %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div><!--.panel-->



<div id="headers" class="col-md-12">

<div class="panel panel-primary">
<div class="panel-heading">
Header
</div>
<div class="panel-body">
<pre class="prettyprint linenums" style="white-space: pre-wrap;">{% for k,v in headers.items %}{{k}}: {{v}}
{% endfor %}</pre>
</div>
</div><!--.panel-->

</div><!--.headers-->

{% if analysis %}
<div id="analysis" class="col-md-12">

<div class="panel panel-primary">
<div class="panel-heading">
Analysis
</div>
<div class="panel-body">
<table class="table">
<tr><th class="col-md-1">content_id</th><td>{{analysis.content.id}}</td></tr>
<tr><th>rule</th><td>{% for r in rule %}{{r}}
{% endfor %}</td></tr>
<tr><th>tag</th><td>{% for t in tags %}{{t}}
{% endfor %}</td></tr>
<tr><th>matched</th><td>{% for m in matched %}{{m}}
{% endfor %}</td></tr>
<tr><th>behavior</th><td><pre class="prettyprint linenums" style="white-space: pre-wrap;">
{{analysis.result}}
</pre></td></tr>
</table>
</div>
</div><!--.panel-->

</div><!--.analysis-->
{% endif %}


<div id="content" class="col-md-12">

<div class="panel panel-primary">
<div class="panel-heading">
Content
</div>
<div class="panel-body">
<form method="post" action="/page/{{p.id}}">{% csrf_token %}
<input type="submit" value="analysis" name="analysis">
<!--<input type="submit" value="wappalyze" name="wappalyze">-->
</form>
<table class="table">
<tr><th  class="col-md-1">id</th><td>{{p.content.id}}</td></tr>
<tr><th>created_at</th><td>{{p.content.created_at|date:"c"}}</td></tr>
<tr><th>type</th><td>{{p.content.type}}</td></tr>
<tr><th>lengtht</th><td>{{p.content.length}}</td></tr>
<tr><th>md5</th><td>{{p.content.md5}}</td></tr>
<tr><th>path</th><td>{{p.content.path}}</td></tr>
<tr><th>commit</th><td>{{p.content.commit}}</td></tr>
</table>
<pre class="prettyprint linenums" style="white-space: pre-wrap;">{{p.content.content}}</pre>
</div>
</div><!--.panel-->

</div><!--.content-->


</div><!--.row-->

{% endblock %}
