{% extends "base.html" %}

{% block title %}
<title>Progress</title>
{% endblock %}

{% block script %}
<script>
$(document).ready(function(){
	var load_progress = function(){
		status = $("div#status").text();
		if(status == "Processing"){
		var data = {
			"job[]":[{% for j in job %}{{j.id}},{% endfor %}]
		};
		$.get('/progress/', data, function(result){
			v = $(result).find("div#view");
			$("div#view").replaceWith(v);
		});
		};
		$("a.colorbox").colorbox();
	};
	setInterval(load_progress, 3000);
});
</script>
{% endblock %}

{% block container %}

<div id="view" class="row">

<div class="col-md-5">

<div id="progress" class="panel panel-primary">
<div class="panel-heading">Status</div>
<div class="panel-body">
<div class="row">
<div id="status" class="col-md-4">{{status}}</div>
<div id="loader" class="col-md-4">
{% if status != "Finished" %}
<img src="/static/images/ajax-loader.gif">
{% endif %}
</div>
</div>
</div><!--.panel-body-->
</div><!--progress-->

<div id="job" class="panel panel-primary">
<div class="panel-heading">
Job
</div>
<div class="panel-body">
<table class="table table-striped table-hover" >
<thead><tr>
<th class="col-md-2">id</th>
<th>input</th>
<th>status</th>
</tr></thead>
<tbody>{% for j in job %}
<tr>
<td class="job_id"><a class="btn btn-primary" href="/job/{{j.id}}">{{j.id}}</a></td>
<td>{{j.query.input}}</td>
<td>{{j.status}}</td>
</tr>
{% endfor %}</tbody>
</table>

</div><!--.panel-body-->

</div><!--panel-->

</div><!--.query-->

<div id="page" class="col-md-7">

<div class="panel panel-primary">
<div class="panel-heading">
Page
</div>
<div class="panel-body">
<table class="table table-striped table-hover ">
<thead>
<tr>
<th class="col-md-1">page</th>
<th class="col-md-1">job</th>
<th>url</th>
<th class="col-md-1">status</th>
<th>capture</th>
</tr>
</thead>
<tbody>
{% for p in page %}
<tr>
<td><a class="btn btn-primary" href="/page/{{p.resource.id}}">{{p.resource.id}}</td>
<td><a class="btn btn-default" href="/job/{{p.job.id}}">{{p.job.id}}</td>
<td>{{p.resource.url}}</td>
<td>{{p.resource.http_status}}</td>
<td>
<a class="colorbox" href="/{{p.resource.capture.path}}">
<img src="data:image/png;base64,{{p.resource.capture.b64thumb}}"></a></td>
</tr>
{% endfor %}
</tbody>
</table>
</div><!--.panel-body-->

</div><!--.panel-->

</div><!--.page-->

</div><!--.row-->

{% endblock %}
